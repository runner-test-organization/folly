# This file was @generated by getdeps.py

name: linux

on:
  push:
    branches:
    - test-codebuild

jobs:
  build:
    runs-on:
      - codebuild-enes-test-${{ github.run_id }}-${{ github.run_attempt }}
      - image:linux-lambda-ruby3.2
      - instance-size:2GB
    continue-on-error: true
    steps:
    - name: cat /proc/cpuinfo
      run: cat /proc/cpuinfo

    - name: uname -mr
      run: uname -mr

    - name: nproc
      run: nproc

    - name: lscpu
      run: lscpu

    - name: free -h
      run: free -h

    - name: lsblk
      run: lsblk

    - name: df -Th
      run: df -Th
    
    - name: ip info
      run: curl ipinfo.io

    - name: lspci
      continue-on-error: true
      run: lspci -vv

    - name: printenv
      run: printenv

    - name: cat /etc/environment
      run: cat /etc/environment

    - name: ls -lah
      run: ls -lah

    - name: ls -lah /home/runner
      continue-on-error: true
      run: ls -lah /home/runner
    
    - name: cat /etc/group
      run: cat /etc/group
   
    - name: cat /etc/passwd
      run: cat /etc/passwd

    - name: groups runner
      continue-on-error: true
      run: groups runner

    - name: sudo ls -lah /var/lib/docker
      continue-on-error: true
      run: sudo ls -lah /var/lib/docker

    - name: sudo ls -lah /var/lib/docker/overlay2
      continue-on-error: true
      run: sudo ls -lah /var/lib/docker/overlay2
    
    - name: sudo du -sh /var/lib/docker
      continue-on-error: true
      run: sudo du -sh /var/lib/docker

    - name: sudo du -sh /var/lib/docker
      continue-on-error: true
      run: sudo du -sh /var/lib/docker

    - name: sudo du -sh /var/lib/docker/overlay2
      continue-on-error: true
      run: sudo du -sh /var/lib/docker/overlay2
  
    - name: sudo lsblk
      continue-on-error: true
      run: sudo lsblk

    - name: sudo df -Th
      continue-on-error: true
      run: sudo df -Th

    - name: install passmark
      run: |
        sudo apt-get install -y libncurses5
        wget "https://www.passmark.com/downloads/pt_linux_x64.zip" -O pt.zip
        unzip pt.zip
    
    - name: run passmark
      run: |
        # Run PerformanceTest with 2 proccesses, 2 iterations
        TERM=xterm ./PerformanceTest/pt_linux_x64 -p 2 -d 2 -i 2 -r 1

    - name: passmark results
      run: cat results_cpu.yml

    - name: install sysbench
      run: |
        sudo apt-get update
        sudo apt-get install -y sysbench

    - name: run sysbench
      run: |
        sysbench --test=cpu run
